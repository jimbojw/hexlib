/*!
 * hexlib JavaScript Library v0.1
 * http://hexlib.com
 *
 * Copyright 2010, Jim R. Wilson
 * Licensed under the MIT license.
 * http://hexlib.com/license
 *
 * Date: Sun Jun 20 22:10:51 2010 -0400
 */
(function(s,t){(function(b,m,i){function a(){}function g(c){for(var n=0,j=arguments.length;n<j;n++){var e=arguments[n];if(e)for(var l in e)if(f.call(e,l))c[l]=e[l]}return c}m=b.hex={version:"0.1"};var h=Array.prototype.join,d=Array.prototype.slice,f=Object.prototype.hasOwnProperty;m.extend=g;g(m,{create:function(c){if(!c)throw"no parent supplied";var n=d.call(arguments,1);a.prototype=c;var j=new a;if(!n.length)return j;n.unshift(j);return g.apply(i,n)},key:function(){return h.call(arguments,",")},
log:function(){this.debug&&b.console&&console.log.apply(console,arguments)}})})(s,s.document);(function(b){b.extend(b,{position:function(m){var i=m.offsetLeft,a=m.offsetTop;for(m=m.offsetParent;m;){i+=m.offsetLeft;a+=m.offsetTop;m=m.offsetParent}return{x:i,y:a}},size:function(m){return{x:m.offsetWidth,y:m.offsetHeight}},style:function(m,i){var a;if(m.currentStyle)a=m.currentStyle[i];else if(s.getComputedStyle)a=t.defaultView.getComputedStyle(m,null).getPropertyValue(i);return a}})})(s.hex);(function(b,
m){var i=Array.prototype.slice,a={};b.extend(b,{evented:{addEvent:function(d,f){if(!this.events)this.events={};var c=this.events[d];if(c===m)c=this.events[d]=[];c[c.length]=f;return this},trigger:function(d){if(!this.events||!this.events[d])return false;for(var f=10,c=this.events[d],n=i.call(arguments,0),j=0,e=c.length,l=false,p=n[0]=b.create(a,{type:d,preventDefault:function(){l=true}}),r=[];j<e;)try{for(;j<e;)c[j++].apply(this,n)}catch(u){r[r.length]=u;setTimeout(function(){throw u;},f++)}return{event:p,
errors:r,prevented:l,args:n}},queue:function(){var d=this.eventqueue;if(!d)d=this.eventqueue=[];d[d.length]=i.call(arguments,0)},fire:function(){var d=this.eventqueue;if(d&&d.length)for(;d.length;)this.trigger.apply(this,d.shift())}}});var g={getTarget:function(){var d=this.target||this.srcElement;if(!d)return m;return d.nodeType===3?d.parentNode:d},inside:function(d){var f=this.mousepos(),c=b.position(d);d=b.size(d);return f.x>c.x&&f.x<c.x+d.x&&f.y>c.y&&f.y<c.y+d.y},mousepos:function(d){var f,c=
0;f=0;if(this.touches&&this.touches.length){f=this.touches[0];c=f.pageX;f=f.pageY}else if(this.changedTouches&&this.changedTouches.length){f=this.changedTouches[0];c=f.pageX;f=f.pageY}else if(this.pageX!==m&&this.pageY!==m){c=this.pageX;f=this.pageY}else if(this.clientX!==m&&this.clientY!==m){c=this.clientX+t.body.scrollLeft+t.documentElement.scrollLeft;f=this.clientY+t.body.scrollTop+t.documentElement.scrollTop}if(d){d=b.position(d);c-=d.x;f-=d.y}return{x:c,y:f}},preventDefault:function(){var d=
this.event;if(d.preventDefault)d.preventDefault();else d.returnValue=false},stopPropagation:function(){var d=this.event;if(d.stopPropagation)d.stopPropagation();else d.cancelBubble=true}},h;if(t.addEventListener){h={remove:function(){return this.elem.removeEventListener(this.type,this.callback)}};b.extend(b,{addEvent:function(d,f,c){function n(j){return c.call(d,b.create(j,g,{event:j}))}d.addEventListener(f,n,false);return b.create(h,{callback:n,elem:d,handler:c,type:f})},removeEvent:function(d,f,
c){d.removeEventListener(f,c,false)}})}else if(t.attachEvent){h={remove:function(){return this.elem.detachEvent("on"+this.type,this.callback)}};b.extend(b,{addEvent:function(d,f,c){function n(){var e=s.event;return c.call(d,b.extend({},e,g,{event:e}))}function j(){d.detachEvent("on"+f,n);s.detachEvent("onunload",j)}d.attachEvent("on"+f,n);s.attachEvent("onunload",j);return b.create(h,{callback:n,elem:d,handler:c,type:f})},removeEvent:function(d,f,c){d.detachEvent("on"+f,c)}})}})(s.hex);(function(b,
m){var i=b.create(b.evented,{defaults:{type:"hexagonal",tapthreshold:400},reorient:function(a,g){this.origin.x=+a;this.origin.y=+g;this.root.style.left=a+"px";this.root.style.top=g+"px";this.elem.style.backgroundPosition=a+"px "+g+"px"}});b.extend(b,{grid:function(a,g){function h(k){var q=k.inside(a),o=k.mousepos(a);k={x:o.x-e.origin.x,y:o.y-e.origin.y};if(p.panning){if(p.enabled&&q){q=k.x-p.x;k=k.y-p.y;j.style.left=q+"px";j.style.top=k+"px";a.style.backgroundPosition=q+"px "+k+"px";e.trigger("panmove",
o.x-p.x-2*e.origin.x,o.y-p.y-2*e.origin.y)}}else{o=e.events.tileover;var v=e.events.tileout,w=e.events.gridover,x=e.events.gridout;if(!(!o&&!v&&!w&&!x)){k=e.translate(k.x,k.y);if(!(q&&l.x===k.x&&l.y===k.y)){v&&l.x!==null&&l.y!==null&&e.queue("tileout",l.x,l.y);!q&&x&&l.x!==null&&l.y!==null&&e.queue("gridout",l.x,l.y);if(q){w&&l.x===null&&l.y===null&&e.queue("gridover",k.x,k.y);o&&e.queue("tileover",k.x,k.y);l.x=k.x;l.y=k.y}else{l.x=null;l.y=null}e.fire()}}}}function d(k){if(k.inside(a)){var q=k.type,
o=k.mousepos(a);if(q==="mouseup"||q==="mousedown")k.preventDefault();if(q==="touchstart")if(!k.touches||k.touches.length<2)k.preventDefault();if(!p.panning&&(q==="mousedown"||q==="touchstart"||q==="MozTouchDown")){p.panning=true;p.x=o.x-2*e.origin.x;p.y=o.y-2*e.origin.y;a.style.cursor="move";e.queue("panstart")}if(p.panning&&(q==="mouseup"||q==="touchend"||q==="MozTouchUp"||q==="MozTouchRelease")){k=o.x-2*e.origin.x-p.x;var v=o.y-2*e.origin.y-p.y;if((k<0?-k:k)>e.tileWidth||(v<0?-v:v)>e.tileHeight)u=
null;if(p.enabled){e.queue("panend",o.x-p.x-2*e.origin.x,o.y-p.y-2*e.origin.y);e.reorient(o.x-e.origin.x-p.x,o.y-e.origin.y-p.y)}p.enabled=true;p.panning=false;p.x=null;p.y=null;a.style.cursor=""}k=e.events.tiledown;v=e.events.tileup;var w=e.events.tileclick,x=e.events.tiletap;if(!(!k&&!v&&!w&&!x)){o={x:o.x-e.origin.x,y:o.y-e.origin.y};o=e.translate(o.x,o.y);if(q==="mousedown"||q==="touchstart"||q==="MozTouchDown"){u=+new Date;if(k)if((q=e.trigger("tiledown",o.x,o.y))&&q.prevented)p.enabled=false;
r.x=o.x;r.y=o.y}else if(q==="mouseup"||q==="touchend"||q==="MozTouchUp"||q==="MozTouchRelease"){v&&e.queue("tileup",o.x,o.y);if(r.x===o.x&&r.y===o.y){w&&e.queue("tileclick",o.x,o.y);x&&u&&+new Date-u<e.tapthreshold&&e.queue("tiletap",o.x,o.y)}r.x=null;u=r.y=null}}e.fire()}}function f(k){if(p.panning){e.reorient(parseInt(j.style.left,10),parseInt(j.style.top,10));p.panning=false;p.x=null;p.y=null;a.style.cursor="";r.x!==null&&r.y!==null&&!k.inside(a)&&e.queue("gridout",r.x,r.y);r.x=null;r.y=null;l.x=
null;u=l.y=null;e.fire()}}function c(k){if(!k.ctrlKey){var q=k.inside(a),o=k.detail?k.detail*-1:k.wheelDelta*0.025;o=o>0?1:o<0?-1:0;if(q&&o){k.preventDefault();k.wheelDeltaX||k.axis&&k.axis===k.HORIZONTAL_AXIS?e.reorient(e.origin.x+e.tileWidth*o,e.origin.y):e.reorient(e.origin.x,e.origin.y+e.tileHeight*o)}}}if(!a||a.nodeType!==1)throw"no DOM element supplied";g=b.extend({},i.defaults,g);if(b.grid[g.type]===m)throw"hex.grid."+g.type+" does not exist";var n=b.style(a,"position");if(n!=="relative"&&
n!=="absolute")a.style.position="relative";if(b.style(a,"overflow")!=="hidden")a.style.overflow="hidden";var j=t.createElement("div");j.style.position="absolute";j.style.left="0px";j.style.top="0px";j.style.overflow="visible";a.appendChild(j);var e=b.create(i,{events:{},origin:{x:0,y:0}},b.grid[g.type],g,{elem:a,root:j}),l={x:null,y:null},p={enabled:true,panning:false,x:null,y:null};b.addEvent(a,"mousemove",h);b.addEvent(a,"mouseover",h);b.addEvent(a,"mouseout",h);b.addEvent(a,"touchmove",h);b.addEvent(a,
"touchstart",h);b.addEvent(a,"touchend",h);b.addEvent(a,"MozTouchDown",h);b.addEvent(a,"MozTouchMove",h);b.addEvent(a,"MozTouchUp",h);b.addEvent(a,"MozTouchRelease",h);var r={x:null,y:null},u=null;b.addEvent(a,"mousedown",d);b.addEvent(a,"mouseup",d);b.addEvent(a,"touchstart",d);b.addEvent(a,"touchend",d);b.addEvent(a,"MozTouchDown",h);b.addEvent(a,"MozTouchUp",h);b.addEvent(a,"MozTouchRelease",h);b.addEvent(t,"mouseup",f);b.addEvent(t,"touchend",f);b.addEvent(t,"gesturestart",f);b.addEvent(t,"gesturechange",
f);b.addEvent(t,"gestureend",f);b.addEvent(t,"MozTouchUp",f);b.addEvent(t,"MozTouchRelease",f);b.addEvent(a,"mousewheel",c);b.addEvent(a,"DOMMouseScroll",c);e.init&&e.init();return e}})})(s.hex);(function(b){var m=Math.floor;b.grid.hexagonal={quadrant:function(i,a){var g=this.tileWidth,h=this.tileHeight;g=m((i-g*0.25)/(g*0.75));h=m(a/h);return{x:g,y:h}},screenpos:function(i,a){var g=this.tileHeight;return{x:i*this.tileWidth*0.75,y:-a*g-i*g*0.5}},tileHeight:42,tileWidth:48,translate:function(i,a){var g=
this.tileWidth*0.5,h=g*0.5,d=h*3,f=this.tileHeight,c=f*0.5,n=c/h,j,e=this.quadrant(i,a);j=e.x;e=e.y;h=(i-h)%d;var l=a%f;if(h<0)h+=d;if(l<0)l+=f;h-=g;if(j%2){g=j;j=(1-j)*0.5-e-(l>c?1:0);if(h<=0||l==c)return{x:g,y:j};if(l<c&&l>c-h*n)return{x:g+1,y:j-1};if(l>c&&l<c+h*n)return{x:g+1,y:j}}else{g=j;j=-j*0.5-e;if(h<=0||l==c)return{x:g,y:j};if(l<c&&l<h*n)return{x:g+1,y:j};if(l>c&&l>f-h*n)return{x:g+1,y:j-1}}return{x:g,y:j}}}})(s.hex);(function(b){var m=Math.ceil,i=Math.floor;b.grid.rectangular={screenpos:function(a,
g){return{x:a*this.tileWidth,y:-g*this.tileHeight}},tileHeight:48,tileWidth:48,translate:function(a,g){return{x:i(a/this.tileWidth),y:m(-g/this.tileHeight)}}}})(s.hex);(function(b){var m=Math.floor;b.grid.skew={e1:{x:21,y:-36},e2:{x:-21,y:-36},init:function(){var i=this.e1.x,a=this.e1.y,g=this.e2.x,h=this.e2.y;if(i*h===g*a)throw"incomputable coefficient";this.coefficient=1/(i*h-g*a);i=[i,i+g,g];a=[a,a+h,h];for(var d=g=h=0,f=0,c=0;c<3;c++){if(i[c]>h)h=i[c];if(i[c]<g)g=i[c];if(a[c]>d)d=a[c];if(a[c]<
f)f=a[c]}this.tileWidth=h-g;this.tileHeight=d-f;this.offset={x:-g,y:-f}},screenpos:function(i,a){return{x:i*this.e1.x+a*this.e2.x,y:i*this.e1.y+a*this.e2.y}},translate:function(i,a){var g=this.coefficient;i-=this.offset.x;a-=this.offset.y;return{x:m(g*(i*this.e2.y-a*this.e2.x)),y:m(g*(a*this.e1.x-i*this.e1.y))}}}})(s.hex);(function(b){var m=Math.floor;b.grid.triangular={tileHeight:48,tileWidth:56,init:function(){var i=this.tileHeight,a=this.tileWidth;this.e1={x:a,y:0};this.e2={x:a*0.5,y:-i};b.grid.skew.init.call(this);
this.tileHeight=i;this.tileWidth=a},screenpos:function(i,a){return b.grid.skew.screenpos.call(this,i*0.5,a)},translate:function(i,a){i-=this.offset.x;a-=this.offset.y;var g=this.coefficient,h=g*(i*this.e2.y-a*this.e2.x);g=g*(a*this.e1.x-i*this.e1.y);var d=m(h),f=m(g);return{x:d*2+(h+g-d-f>1?1:0),y:f}}}})(s.hex);(function(b){var m=b.create(b.evented);b.extend(b,{region:function(i,a){if(!i)throw"no grid was supplied";a=b.extend({},a);if(typeof a.inside!=="function")throw"options.inside is not a function";
var g=b.create(m,a,{grid:i}),h=false;i.addEvent("tileover",function(f,c,n){f=g.inside(c,n);if(f!==h)g.trigger(f?"regionover":"regionout",c,n);h=f});i.addEvent("gridout",function(f,c,n){h&&g.trigger("regionout",c,n);h=false});var d=false;i.addEvent("tiledown",function(f,c,n){(f=g.inside(c,n))&&g.trigger("regiondown",c,n);d=f});i.addEvent("tileup",function(f,c,n){if(g.inside(c,n)){g.trigger("regionup",c,n);d&&g.trigger("regionclick",c,n)}});return g}})})(s.hex);(function(b,m){var i={},a={defaults:{delay:100,
repeat:false},animate:function(h){h=b.extend({},a.defaults,h);var d=this.elem,f=this.coords,c=f[0],n=f[2],j=this.sprite.spritemap.width,e=h.repeat,l=0,p;p=this.timeout=s.setInterval(function(){l++;if(l>=n)if(e)l=0;else{s.clearTimeout(p);return}d.style.left=-(c+l)*j+"px"},h.delay)},stop:function(){s.clearTimeout(this.timeout)}},g={defaults:{},sprite:function(){var h=b.create(i,{spritemap:this}),d=h.base=t.createElement("div");d.className="sprite";b.extend(d.style,{position:"relative",overflow:"hidden",
width:this.width+"px",height:this.height+"px"});for(var f=h.layers=[],c=0,n=arguments.length;c<n;c++){var j=arguments[c],e=this.map[j],l=e[0],p=e[1],r=t.createElement("div");f[c]=b.create(a,{type:j,elem:r,sprite:h,coords:e});b.extend(r.style,{position:"absolute",width:this.mapwidth+"px",height:this.mapheight+"px",top:-p*this.height+"px",left:-l*this.width+"px",backgroundImage:"url('"+this.url+"')",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.url+"', sizingMethod='crop')"});
d.appendChild(r)}return h}};b.extend(b,{spritemap:function(h){if(h===m)throw"no options hash was supplied";h=b.extend({},g.defaults,h);var d=h.map,f=0,c=0;for(var n in d){var j=d[n];if(j[0]>f)f=j[0];if(j[1]>c)c=j[1]}return b.create(g,{mapwidth:(f+1)*h.width,mapheight:(c+1)*h.height},h)}})})(s.hex)})(window,window.document);
